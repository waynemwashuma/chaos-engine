(function(u,b){typeof exports=="object"&&typeof module<"u"?b(exports):typeof define=="function"&&define.amd?define(["exports"],b):(u=typeof globalThis<"u"?globalThis:u||self,b(u.Chaos={}))})(this,function(u){var pi;"use strict";var mi=Object.defineProperty;var fi=(u,b,I)=>b in u?mi(u,b,{enumerable:!0,configurable:!0,writable:!0,value:I}):u[b]=I;var o=(u,b,I)=>(fi(u,typeof b!="symbol"?b+"":b,I),I);const b={AABBColliding(a,t){return a.min.x<=t.max.x&&a.max.x>=t.min.x&&a.min.y<=t.max.y&&a.max.y>=t.min.y},boundSpheresColliding(a,t){return(a.x-t.x)*(a.x-t.x)+(a.y-t.y)*(a.y-t.y)<a.r*a.r+t.r*t.r},AABBvsSphere(a,t){const e=Math.max(box.min.x,Math.min(t.pos.x,box.max.x)),s=Math.max(box.min.y,Math.min(t.pos.y,box.max.y));return(e-t.pos.x)*(e-t.pos.x)+(s-t.pos.y)*(s-t.pos.y)<t.radius}},I=Math.PI/180,Yt=1/I;function R(a=0,t=1){return Math.random()*(t-a)+a}function M(a){return a*a}function zt(a,t=2){return a**t}function Wt(a){return Math.sqrt(a)}function Gt(a,t,e){return a+e*(t-a)}function F(a,t=4){return t=10**t,Math.round(a*t)/t}function Jt(a,t,e){return a<t?t:a>e?e:a}function it(a,t,e,s,n){return s+a*(n-s)/(e-t)}function dt(a,t){return a>t?(a+t)*(a+t+1)/2+a:(a+t)*(a+t+1)/2+t}function Xt(a){return a*I}function Kt(a){return a*Yt}let j={x:0,y:0},pt=Math.PI*2;/**
 * This is a 2D vector class.It has been optimized to reduce garbage collection and for perfomance when used properly
 * @author Wayne Mwashuma <mwashumawayne@gmail.com>
 * @license MIT
 */const w=class{constructor(t,e){o(this,pi,function*(){yield this.x,yield this.y});this.x=t||0,this.y=e||0}get CHOAS_CLASSNAME(){return this.constructor.name.toLowerCase()}get CHAOS_OBJ_TYPE(){return"vector"}magnitude(){return Math.sqrt(this.magnitudeSquared())}setMagnitude(t){this.normalize().multiply(t)}magnitudeSquared(){return this.y**2+this.x**2}distanceTo(t){return j.x=this.x-t.x,j.y=this.y-t.y,Math.sqrt(w.prototype.magnitudeSquared.call(j))}distanceToSquared(t){return j.x=this.x-t.x,j.y=this.y-t.y,w.prototype.magnitudeSquared.call(j)}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}multiply(t){return this.x*=t,this.y*=t,this}divide(t){return this.multiply(1/t),this}normalize(){const t=this.magnitude();return t==0?this:(this.x=this.x/t,this.y=this.y/t,this)}equals(t){return t.x===this.x&&t.y===this.y}equalsZero(){return this.x===0&&this.y===0}normal(t=1,e){return e=e||new w,e.copy(this).normalize(),e.set(-e.y*t,e.x*t)}rotate(t){let e=this.x,s=Math.cos(t),n=Math.sin(t);return this.x=e*s-this.y*n,this.y=e*n+this.y*s,this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}clone(){return new w(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}set(t,e){return this.x=t,this.y=e,this}draw(t,e=0,s=0,n="red",r=1){return t.beginPath(),t.moveTo(e,s),t.lineTo(this.x*r+e,this.y*r+s),t.strokeStyle=n,t.stroke(),t.strokeStyle="black",t.closePath(),this}reverse(){return this.multiply(-1)}reflect(t,e){return e=e||new w,e.copy(t).multiply(this.dot(t)*2).sub(this)}clamp(t=0,e=1){let s=this.magnitude();if(s==0)return this;let n=Math.max(t,Math.min(s,e))/s;return this.multiply(n)}static getAbsDegBtwn(t,e){let s=t.cross(e),n=w.getDegBtwn(t,e);return s<0?n:360-n}static getAbsRadBtwn(t,e){let s=t.cross(e),n=w.getDegBtwn(t,e);return s<0?n:360-n}static getRadBtwn(t,e){return Math.acos(t.dot(e)/(t.magnitude()*e.magnitude()))}static getDegBtwn(t,e){return w.getRadBtwn(t,e)*180/Math.PI}static fromRad(t,e=new w){return e.set(Math.cos(t),Math.sin(t))}static fromDeg(t,e){return w.fromRad(t*Math.PI/180,e)}static random(t){return w.fromRad(Math.random()*pt,t)}static lerp(t,e,s,n){return n=n||new w,n.copy(t).set((e.x-t.x)*s+t.x,(e.y-t.y)*s+t.y)}static toDeg(t){return w.toRad(t)/Math.PI*180}static toRad(t){let e=Math.atan2(t.y,t.x);return e<0?pt+e:e}};let c=w;pi=Symbol.iterator,o(c,"ZERO",Object.freeze(new w));class B{constructor(t){this._deg=t||0,this._rad=t*Math.PI/2||0}get CHOAS_CLASSNAME(){return this.constructor.name.toLowerCase()}get CHAOS_OBJ_TYPE(){return"angle"}set degree(t){this._deg=t,this._rad=t*Math.PI/180}set radian(t){this._rad=t,this._deg=t*180/Math.PI}get radian(){return this._rad}get degree(){return this._deg}copy(t){this.degree=t.degree}static fromJSON(t){return new B(t._deg)}}class Y{constructor(t,e,s,n,r,h){this.a=t||1,this.b=e||0,this.c=s||0,this.d=n||1,this.e=r||0,this.f=h||0}get CHOAS_CLASSNAME(){return this.constructor.name.toLowerCase()}get CHAOS_OBJ_TYPE(){return"matrix"}rotate(t){let e=Math.sin(t),s=Math.cos(t);return this.a=s,this.c=-e,this.b=e,this.d=s,this}translate(t,e){return this.e+=t,this.f+=e,this}transform(t){let e=t.x,s=t.y;return t.x=this.a*e+this.c*s+this.e,t.y=this.b*e+this.d*s+this.f,t}clone(){return new Y(...this)}copy(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this}*[Symbol.iterator](){yield this.a,yield this.b,yield this.c,yield this.d,yield this.e,yield this.f}}let z=`ðŸš€Chaos Engine Says::::
`,mt=[];const v={};v.warn=function(a){console.warn(z+a)},v.throw=function(a){throw new Error(z+a)},v.error=function(a){console.error(z+a)},v.log=function(a){console.log(z+a)},v.warnOnce=function(a){mt.includes(a)||(mt.push(a),v.warn(a))},v.assert=function(a,t,e){return a||t(e),a};const y={};let Zt=0;y.appendArr=function(a,t){for(var e=0;e<t.length;e++)a.push(t[e])},y.clearArr=function(a){for(var t=a.length;t>0;t--)a.pop()},y.popArr=function(a,t){let e=a.length;for(var s=e;s>e-t;s--)a.pop()},y.removeElement=function(a,t){if(t==-1)return null;if(a.length-1==t)return a.pop();let e=a[t];return a[t]=a.pop(),e},y.generateID=function(){return Zt+=1},y.inheritComponent=function(a,t=!0,e=!0){if(a==null||typeof a!="function")return;let s=a.prototype;if(s.destroy){let n=a.destroy;s.destroy=function(){this.entity=null,n.call(this)}}else s.destroy=function(){this.entity=null};if(s.init&&t){let n=s.init;s.init=function(r){this.entity=r,n.call(this,r)}}else s.init||(s.init=function(n){this.entity=n});!s.update&&e&&(s.update=function(){v.warnOnce("Please override the update function in the component "+s.constructor.name)}),s.getComponent=function(n){return this.parent.getComponent(n)},s.requires=function(...n){for(var r=0;r<n.length;r++)this.entity.has(n[r])||v.throw(`The component \`${this.CHOAS_CLASSNAME}\` requires another component \`${n[r]}\` but cannot find it in the Entity with id ${this.entity.id}`)},s.query=function(n,r=[]){return this.parent.query(n,r)},Object.defineProperty(s,"CHOAS_CLASSNAME",{get:function(){return this.constructor.name.toLowerCase()},enumerable:!0,configurable:!1}),Object.defineProperty(s,"CHAOS_OBJ_TYPE",{get:function(){return"component"},enumerable:!0,configurable:!1})},y.inheritSystem=function(a){if(a==null||typeof a!="function")return;let t=a.prototype;t.init||(t.init=function(){v.warnOnce("Please override the init method in the system "+t.constructor.name)}),t.update||(t.update=function(){v.warnOnce("Please override the update method in the system "+t.constructor.name)}),t.add||(t.add=function(e){this.objects.push(e)}),t.remove||(t.remove=function(e){let s=this.objects.indexOf(e);y.removeElement(this.objects,s)})};class st{constructor(){this.lastcall=0,this.dt=0}getFrameRate(){return 1/(this.dt/1e3)}getRoundedFrameRate(){return Math.round(this.getFrameRate())}update(t){return this.dt=t-this.lastcall,this.framerate=this.getFrameRate(),this.lastcall=t,this.delta=this.dt/1e3,this.delta}}class W{constructor(){o(this,"entity",null)}}y.inheritComponent(W);class D extends W{constructor(t,e,s,n){super(),this.pos={x:0,y:0},this.max={x:s,y:n},this.min={x:t,y:e},this.padding=0}intersects(t){return t.r?b.AABBvsSphere(this,t):b.AABBColliding(this,t)}calculateBounds(t,e=0){let s=Number.MAX_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,r=-Number.MAX_SAFE_INTEGER,h=-Number.MAX_SAFE_INTEGER;if(t.shapes.length==0){this.min.x=t.position.x,this.max.x=t.position.x,this.min.y=t.position.y,this.max.y=t.position.y,this.pos.x=t.position.x,this.pos.y=t.position.y;return}for(var l=0;l<t.shapes.length;l++){let f=t.shapes[l];if(f.type==0){let m=t.position.x-f.radius,d=t.position.y-f.radius,_=t.position.x+f.radius,S=t.position.y+f.radius;(!s||m<s)&&(s=m),(!r||_>r)&&(r=_),(!n||d<n)&&(n=d),(!h||S>h)&&(h=S);continue}for(var p=0;p<f.vertices.length;p++){let m=f.vertices[p];m.x<s&&(s=m.x),m.x>r&&(r=m.x),m.y<n&&(n=m.y),m.y>h&&(h=m.y)}}this.min.x=s-e,this.max.x=r+e,this.min.y=n-e,this.max.y=h+e,this.pos.x=t.position.x,this.pos.y=t.position.y,this.padding=e}update(t){let e=t.x-this.pos.x,s=t.y-this.pos.y;this.pos.x=t.x,this.pos.y=t.y,this.min.x+=e,this.max.x+=e,this.min.y+=s,this.max.y+=s}draw(t){t.strokeStyle="red",t.moveTo(this.min.x,this.min.y),t.lineTo(this.min.x,this.max.y),t.lineTo(this.max.x,this.max.y),t.lineTo(this.max.x,this.min.y),t.lineTo(this.min.x,this.min.y),t.stroke(),t.strokeStyle="black"}static union(t,e,s){return s=s||new D,s.max.x=t.max.x>e.max.x?t.max.x:e.max.x,s.max.y=t.max.y>e.max.y?t.max.y:e.max.y,s.min.x=t.min.x<e.min.x?t.min.x:e.min.x,s.min.y=t.min.y<e.min.y?t.min.y:e.min.y,s}get area(){return(this.max.x-this.min.x)*(this.max.y-this.min.y)}clone(){let t=new D;return t.min.x=this.min.x,t.max.x=this.max.x,t.min.y=this.min.y,t.max.y=this.max.y,t.pos.x=this.pos.x,t.pos.y=this.pos.y,t.padding=this.padding,t}}class ft{constructor(t){this.vertices=t,this.normals=this.calcFaceNormals(),this._dynNormals=this.normals.map(e=>e.clone())}get CHOAS_CLASSNAME(){return this.constructor.name.toLowerCase()}get CHAOS_OBJ_TYPE(){return"geometry"}getNormals(t,e){e=e||[];for(var s=0;s<this.normals.length;s++)e.push(this._dynNormals[s].copy(this.normals[s]).rotate(t));return e}calcFaceNormals(){const t=[],{vertices:e}=this;for(var s=0;s<e.length;s++){let r=e[s>=e.length?e.length-1:s].clone().sub(e[s+1>=e.length?0:s+1]).normal();for(var n=0;n<t.length;n++)if(r.equals(t[n])||r.clone().reverse().equals(t[n])){r=null;break}r&&t.push(r)}return t}transform(t,e,s,n){for(let r=0;r<this.vertices.length;r++){let h=t[r];h.copy(this.vertices[r]),h.rotate(s),h.multiply(n),h.add(e)}}}const Qt=Object.freeze({CIRCLE:0,POLYGON:1}),C=Object.freeze({CONSTRAINT:0,BODY:1,COMPOSITE:2}),A={posDampen:.8,linearDamping:0,angularDamping:0,velocitySolverIterations:1,fixedFrameRate:.016,mass:1,restitution:.6,staticFriction:.4,kineticFriction:.2,boundPadding:0,allowSleep:!1,aabbDetectionOnly:!1,collisionResponse:!0,autoUpdateBound:!0,type:Object.freeze({DYNAMIC:2,KINEMATIC:1,STATIC:0}).DYNAMIC};let te=new c;class E{constructor(t,e=new c,s=0){o(this,"type",Qt.POLYGON);o(this,"offAngle",0);o(this,"offPosition",null);o(this,"vertices",null);o(this,"geometry",null);this.offPosition=e,this.offAngle=s*Math.PI/180,this.vertices=t.map(n=>n.clone()),this.geometry=new ft(t)}get CHOAS_CLASSNAME(){return this.constructor.name.toLowerCase()}get CHAOS_OBJ_TYPE(){return"shape"}getNormals(t,e){return this.geometry.getNormals(this.angle,e)}drawNormals(t,e=10){const{vertices:s}=this;if(s.length<2)return;let n,r;t.beginPath(),t.strokeStyle="green";for(var h=0;h<s.length-1;h++)n=s[h+1].clone().sub(s[h]).multiply(.5),r=n.normal(),n=s[h].clone().add(n),t.moveTo(n.x,n.y),t.lineTo(r.x*e+n.x,r.y*e+n.y),t.stroke();n=s[0].clone().sub(s[s.length-1]).multiply(.5),r=n.normal(),n=s[s.length-1].clone().add(n),t.moveTo(n.x,n.y),t.lineTo(r.x*e+n.x,r.y*e+n.y),t.stroke(),t.strokeStyle="black",t.closePath()}draw(t,e){const{vertices:s}=this.geometry;t.beginPath(),t.strokeStyle="black",t.moveTo(s[0].x,s[0].y);for(var n=1;n<s.length;n++)t.lineTo(s[n].x,s[n].y);t.lineTo(s[0].x,s[0].y),t.stroke(),e&&(t.fillStyle=e,t.fill()),t.closePath(),t.beginPath(),t.arc(0,0,2,0,Math.PI*2),t.fillStyle="black",t.fill(),t.stroke(),t.closePath()}update(t,e,s){this.angle=this.offAngle+e,this.geometry.transform(this.vertices,te.copy(t).add(this.offPosition),this.angle,1,t)}getVertices(){return this.vertices}static calcInertia(){throw new Error("Implement in the children classes")}}o(E,"CIRCLE",0),o(E,"POLYGON",1);class yt extends E{constructor(t,e,s){let n=new c(1).multiply(t/2),r=new c(1).multiply(-t/2);super([n,r],e,s),this.length=t}}let gt=new c,ee=new c;class G extends E{constructor(e,s,n){super([],s,n);o(this,"position",new c);o(this,"angle",0);o(this,"radius",0);o(this,"type",E.CIRCLE);this.radius=e}static calcInertia(e,s){return e*(s*s)/4}getVertices(e,s){s=s||[];let n=gt.copy(e).multiply(-this.radius).add(this.position),r=ee.copy(e).multiply(this.radius).add(this.position);return s[0]=n.clone(),s[1]=r.clone(),s}getNormals(e,s=[]){let n=null,r=null;for(let h=0;h<e.vertices.length;h++){let l=this.position.distanceToSquared(e.vertices[h]);(!n||n>l)&&(r=e.vertices[h],n=l)}return r||(r=e.position),s.push(gt.copy(r).sub(this.position).normalize().clone()),s}update(e,s,n){this.position.copy(e).add(this.offPosition),this.angle=this.offAngle+s}draw(e,s){e.beginPath(),e.strokeStyle="black",e.arc(0,0,this.radius,0,Math.PI*2),e.lineWidth=1,e.stroke(),s&&(e.fillStyle=s,e.fill()),e.closePath(),e.beginPath(),e.arc(0,0,2,0,Math.PI*2),e.fillStyle="black",e.fill(),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(0,0);let n=c.fromDeg(this.angle).multiply(this.radius);e.lineTo(...n),e.stroke(),e.closePath()}drawNormals(){}get area(){return Math.PI*this.radius*this.radius}}class J extends E{constructor(e,s,n,r){let h=new c(-e/2,-s/2),l=new c(-e/2,s/2),p=new c(e/2,s/2),f=new c(e/2,-s/2);super([h,l,p,f],n,r);o(this,"height",0);o(this,"width",0);this.height=s,this.width=e}static calcInertia(e,s,n){return e*(M(s)+M(n))/12}get area(){return this.width*this.height}}let ie=new c,se=new c;class ne extends E{constructor(t,e,s,n,r){let h=ie.set(1,0).multiply(t),l=c.fromDeg(s,se).multiply(e);super([new c(-h.x/2,-l.y/2),new c(h.x/2,-l.y/2),new c(l.x/2,l.y/2)],n,r)}}const et=class{constructor(...t){o(this,"id",y.generateID());o(this,"_position",new c);o(this,"_velocity",new c);o(this,"_acceleration",new c);o(this,"_orientation",new B);o(this,"_rotation",new B);o(this,"bounds",new D);o(this,"_mass",1);o(this,"_inertia",0);o(this,"_type",null);o(this,"_localanchors",[]);o(this,"anchors",[]);o(this,"lastPosition",new c);o(this,"inv_mass",0);o(this,"inv_inertia",0);o(this,"restitution",A.restitution);o(this,"staticFriction",A.staticFriction);o(this,"kineticFriction",A.kineticFriction);o(this,"boundPadding",A.boundPadding);o(this,"index",-1);o(this,"mask",{layer:0,group:0});o(this,"entity",null);o(this,"bounds",null);o(this,"shapes",null);o(this,"allowSleep",A.allowSleep);o(this,"sleeping",!1);o(this,"aabbDetectionOnly",A.aabbDetectionOnly);o(this,"collisionResponse",A.collisionResponse);o(this,"autoUpdateBound",A.autoUpdateBound);this.type=A.type,this.shapes=t,this.mass=1,this.inertia=1}set type(t){(t===et.STATIC||t===et.KINEMATIC)&&(this.mass=0),this._type=t}get type(){return this._type}get physicsType(){return C.BODY}get CHOAS_CLASSNAME(){return this.constructor.name.toLowerCase()}get CHAOS_OBJ_TYPE(){return"body"}get acceleration(){return this._acceleration}set acceleration(t){this._acceleration.copy(t)}get velocity(){return this._velocity}set velocity(t){this._velocity.copy(t)}get rotation(){return this._rotation}set rotation(t){this._rotation.copy(t)}set angle(t){this.orientation.degree=t}get angle(){return this.orientation.degree}set mass(t){this._mass=t,this.inv_mass=t===0?0:1/t,t==0&&(this.inertia=0)}get mass(){return this._mass}set density(t){let e=0;for(var s=0;s<this.shapes.length;s++)e+=this.shapes[s].area;this.mass=t*e*.01}get density(){let t=0;for(var e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return 100*this.mass/t}set inertia(t){this._inertia=t,this.inv_inertia=t==0?0:1/t}get inertia(){return this._inertia}get position(){return this._position}set position(t){this._position.copy(t)}set orientation(t){this._orientation.copy(t)}get orientation(){return this._orientation}get angularVelocity(){return this.rotation.degree}set angularVelocity(t){this.rotation.degree=t}setAnchor(t){return this.anchors.push(new c(t.x,t.y).rotate(this.orientation.radian).add(this.position)),this._localanchors.push(t)-1}getAnchor(t){return this.anchors[t]}getLocalAnchor(t,e=new c){return e.copy(this._localanchors[t]).rotate(this.orientation.radian)}applyForce(t,e=c.ZERO){this.acceleration.add(t.multiply(this.inv_mass)),this.rotation.degree+=e.cross(t)*this.inv_inertia}init(t,e=!1){if(this.entity=t,e){this.bounds=new D,this.update();return}this.requires("transform","movable","bounds");let s=t.get("transform"),n=t.get("bounds"),r=t.get("movable");this._acceleration=r.acceleration,this._rotation=r.rotation,this._velocity=r.velocity,this._position=s.position,this._orientation=s.orientation,this.bounds=n,this.update()}update(){for(var t=0;t<this.shapes.length;t++)this.shapes[t].update(this.position,this._orientation.radian);for(var t=0;t<this.anchors.length;t++)this.anchors[t].copy(this._localanchors[t]).rotate(this.orientation.radian).add(this.position);this.autoUpdateBound&&this.bounds.calculateBounds(this,this.boundPadding),this.bounds.update(this.position)}};let T=et;o(T,"STATIC",C.STATIC),o(T,"KINEMATIC",C.KINEMATIC),o(T,"DYNAMIC",C.DYNAMIC),y.inheritComponent(T,!1,!1);class re extends T{constructor(t,e){let s=[],n=[];for(let r=0;r<e.length;r++)s.push(new c(t*r,e[r]));for(let r=1;r<s.length;r++){let h=new yt(s[r-1],s[r]);n.push(h)}super(new c,...n),this.mass=0,this.mask.layer=0}}class ae extends T{constructor(t){super(new G(t)),this.inertia=G.calcInertia(this.mass,t)}get mass(){return this._mass}set mass(t){this._mass=t,this.inv_mass=t===0?0:1/t,this.inertia=G.calcInertia(this.mass,this.shapes[0].radius)}}class oe extends T{constructor(t,e){super(new J(t,e)),this.inertia=J.calcInertia(this._mass,t,e)}set mass(t){this._mass=t,this.inv_mass=t===0?0:1/t,this.inertia=J.calcInertia(t,this.shapes[0].width,this.shapes[0].height)}get mass(){return this._mass}}class vt{constructor(){o(this,"entity",null);this.bodies=[],this.constraints=[]}get physicsType(){return C.COMPOSITE}init(t){this.bodies.forEach(e=>{e.init(t,!0)}),this.requires("transform")}add(t){if(t.physicsType===C.CONSTRAINT)return this.constraints.push(t);t.physicsType===C.BODY&&this.bodies.push(t)}update(){this.lastPosition.copy(this.position)}get acceleration(){let t=new c;for(var e=0;e<this.bodies.length;e++)t.copy(this.bodies[e].acceleration);return t.divide(this.bodies.length)}set acceleration(t){for(var e=0;e<this.bodies.length;e++)this.bodies[e].acceleration=t}get velocity(){let t=new c;for(var e=0;e<this.bodies.length;e++)t.add(this.bodies[e].velocity);return t.divide(this.bodies.length)}set velocity(t){for(var e=0;e<this.bodies.length;e++)this.bodies[e].velocity.copy(t)}set angle(t){for(var e=0;e<this.bodies.length;e++)this.bodies[e].angle=x}get angle(){let t=0;for(var e=0;e<this.bodies.length;e++)t+=this.bodies[e].angle}set mass(t){for(var e=0;e<this.bodies.length;e++)this.bodies[e].mass=t}get mass(){let t=0;for(var e=0;e<this.bodies.length;e++)t+=this.bodies[e].mass;return t}set density(t){for(var e=0;e<this.bodies.length;e++)this.bodies[e].density=t}get density(){let t=0;for(var e=0;e<this.bodies.length;e++)t+=this.bodies[e].density;return t/this.bodies.length}get position(){let t=new c;for(var e=0;e<this.shapes.length;e++)t.add(this.bodies[e].position);return t}set position(t){let e=t.clone().sub(this.position);for(var s=0;s<this.bodies.length;s++)this.bodies[s].position.add(e)}set orientation(t){for(var e=0;e<this.bodies.length;e++)this.bodies[e].orientation.copy(t)}get angularVelocity(){let t=0;for(var e=0;e<this.bodies.length;e++)t+=this.bodies[e].angularVelocity;return t}set angularVelocity(t){for(var e=0;e<this.bodies.length;e++)this.bodies[e].angularVelocity=t}}y.inheritComponent(vt);class nt{constructor(t,e){this.body1=t,this.body2=e,this.stiffness=50,this.dampening=.03}get physicsType(){return C.CONSTRAINT}get CHOAS_CLASSNAME(){return this.constructor.name.toLowerCase()}get CHAOS_OBJ_TYPE(){return"constraint"}behavior(t,e){e.position.copy(t.position)}update(t){this.behavior(this.body1,this.body2,t)}}let le=new c,he=new c,ce=new c,X=new c,K=new c,_t=new c;class ue extends nt{constructor(t,e,s,n){super(t,e),this.localA=new c().copy(s||_t),this.localB=new c().copy(n||_t),this.fixed=!t.mass||!e.mass,this.dampen=1,this.maxDistance=1,this.stiffness=1}behavior(t,e,s){let n=le.copy(this.localA).rotate(t.angle*Math.PI/180),r=he.copy(this.localB).rotate(e.angle*Math.PI/180),h=ce.copy(t.position).add(n),l=X.copy(e.position).add(r),p=h.sub(l),f=p.magnitude();if(f===0)return;let m=(f-this.maxDistance)/f,d=p.multiply(m*this.stiffness*this.dampen),_=t.inv_mass+e.inv_mass;t.inv_inertia+e.inv_inertia,X.copy(d),d.divide(_*2),t.velocity.add(K.copy(d).multiply(-t.inv_mass).divide(s)),e.velocity.add(K.copy(d).multiply(e.inv_mass).divide(s)),t.position.add(K.copy(d).multiply(-t.inv_mass)),e.position.add(K.copy(d).multiply(e.inv_mass)),t.rotation.radian+=X.cross(n)*t.inv_inertia,e.rotation.radian+=X.cross(r)*-e.inv_inertia}}let de=new c,pe=new c,me=new c,Z=new c,wt=new c,xt=new c,bt=new c;class fe extends nt{constructor(t,e,s,n){super(t,e),this.localA=new c().copy(s||bt),this.localB=new c().copy(n||bt),this.fixed=!t.mass||!e.mass,this.dampen=1,this.maxDistance=1,this.stiffness=1}behavior(t,e,s){let n=de.copy(this.localA).rotate(t.angle*Math.PI/180),r=pe.copy(this.localB).rotate(e.angle*Math.PI/180),h=me.copy(t.position).add(n),l=Z.copy(e.position).add(r),p=h.sub(l),f=p.magnitude();if(f===0)return;let m=(f-this.maxDistance)/f,d=p.multiply(m*this.stiffness*this.dampen),_=t.inv_mass+e.inv_mass;t.inv_inertia+e.inv_inertia,Z.copy(d),d.divide(_*2),t.velocity.add(xt.copy(d).multiply(-t.inv_mass).divide(s)),e.velocity.add(wt.copy(d).multiply(e.inv_mass).divide(s)),t.position.add(xt.copy(d).multiply(-t.inv_mass)),e.position.add(wt.copy(d).multiply(e.inv_mass)),t.rotation.radian+=Z.cross(n)*t.inv_inertia,e.rotation.radian+=Z.cross(r)*-e.inv_inertia}}let rt=new c,at=new c,St=new c;class ye{static solve(t,e){at.copy(t.acceleration).multiply(e*.5),St.copy(t.velocity),rt.copy(t.position),t.acceleration.set(0,0),t.velocity.add(at),rt.add(St.multiply(e)).add(at.multiply(e)),t.position=rt,t.angle+=t.angularVelocity*e}}let ge=new c,ve=new c,_e=new c,At=new c,Ct=new c;class we{static solve(t){let{bodyA:e,bodyB:s,ca1:n,ca2:r,restitution:h,impulse:l}=t,{axis:p}=t.contactData;if(l<=0)return;let f=ge.set(n.y*-e.rotation._rad,n.x*e.rotation._rad),m=ve.set(r.y*-s.rotation._rad,r.x*s.rotation._rad),d=_e.copy(e.velocity).add(f),_=At.copy(s.velocity).add(m),S=d.sub(_);if(S.magnitudeSquared()===0)return;let g=p.normal(1,At);if(g=g.multiply(g.dot(S)),g.magnitudeSquared()===0)return;g.normalize();let k=g.dot(S),H=Math.min(e.staticFriction,s.staticFriction),ut=Math.min(e.kineticFriction,s.kineticFriction),U=-k/(e.inv_mass+s.inv_mass+M(n.dot(g)*e.inv_inertia+M(r.dot(g))*s.inv_inertia)),L;Math.abs(U)<=l*H?L=g.multiply(U):L=g.multiply(U*ut),t.velA.add(Ct.copy(L).multiply(e.inv_mass)),t.velB.add(Ct.copy(L).multiply(-s.inv_mass)),t.rotA+=n.cross(L)*e.inv_inertia,t.rotB+=r.cross(L)*-s.inv_inertia}}let Q={x:0,y:0},Pt=1,tt=1,xe=.8;class be{static solve(t,e,s,n){n==2&&(Math.abs(t.angularVelocity)>tt&&(t.angularVelocity=0),Math.abs(e.angularVelocity)>tt&&(e.angularVelocity=0)),!(s>xe)&&(t.velocity.magnitude()>Pt&&Math.abs(t.angularVelocity)>tt||e.velocity.magnitude()>Pt&&Math.abs(e.angularVelocity)>tt||!t.allowSleep||!e.allowSleep||(t.sleeping=!0,t.velocity=Q,t.acceleration=Q,e.sleeping=!0,e.velocity=Q,e.acceleration=Q))}}const Tt=new c,Se=new c;let Ae=A.posDampen;class Ce{static warmstart(t,e){if(t.stmp!==e)return;let s=t.contactData.lastOverlap-t.contactData.overlap;t.contactData.overlap-=s*.2}static solve(t,e){let{bodyA:s,bodyB:n,ca1:r,ca2:h}=t,{axis:l,overlap:p}=t.contactData;const m=p*Ae/(s.inv_mass+n.inv_mass+M(r.cross(l))*s.inv_inertia+M(h.cross(l))*n.inv_inertia);let d=Se.copy(l).multiply(m);s.velocity.add(Tt.copy(d).multiply(s.inv_mass*e)),n.velocity.add(Tt.copy(d).multiply(-n.inv_mass*e)),s.rotation.radian+=r.cross(d)*s.inv_inertia*e,n.rotation.radian+=h.cross(d)*-n.inv_inertia*e,t.contactData.lastOverlap=p}}let Pe=new c,Te=new c,Me=new c,Be=new c;class Ee{static solve(t){let{bodyA:e,bodyB:s,ca1:n,ca2:r,restitution:h}=t,{axis:l}=t.contactData,p=Pe.set(n.y*-e.rotation.radian,n.x*e.rotation.radian),f=Te.set(r.y*-s.rotation.radian,r.x*s.rotation.radian),m=Me.copy(e.velocity).add(p),d=Be.copy(s.velocity).add(f),_=m.sub(d),S=l.dot(_);if(S>=0){t.impulse=0;return}let g=-h*S/(e.inv_mass+s.inv_mass+M(n.cross(l))*e.inv_inertia+M(r.cross(l))*s.inv_inertia),k=l.clone().multiply(g),H=n.cross(k)*e.inv_inertia,ut=r.cross(k)*-s.inv_inertia,U=k.clone().multiply(e.inv_mass),L=k.clone().multiply(-s.inv_mass);t.velA.copy(U),t.velB.copy(L),t.rotA=H,t.rotB=ut,t.impulse=g}}const ke=[],Ie={overlap:0,verticesA:null,verticesB:null,axis:new c,vertex:null,shape:null},Oe={min:0,max:0,indexN:0},Le={min:0,max:0,indexN:0},De=new c,Ne=new c,$=new c,P={shapesInBodyCollided(a,t,e){let s=a.shapes,n=t.shapes;for(var r=0;r<s.length;r++)for(var h=0;h<n.length;h++)P.shapesCollided(s[r],n[h],e);if(e.overlap<0)return e;let l=e.dorminantShape,p=Ne.copy(e.axis),f=e.shapes[0],m=e.shapes[1],d=[];const _=P.findNearSupports(e.vertShapeA,p,[]),S=P.findNearSupports(e.vertShapeB,$.copy(p).reverse(),[]);for(var r=0;r<_.length;r++)P.shapeContains(m,_[r])&&d.push(_[r]);if(d.length<2)for(var r=0;r<S.length;r++)P.shapeContains(f,S[r])&&(d.push(S[r]),d.length||(shape=m));return d.length==0&&d.push(_[0]),d=P.findNearSupports(d,p,[]),l==m&&p.reverse(),l==f&&(e.verticesA[0]=d[0],e.verticesB[0]=d[0].clone().add($.copy(p).multiply(e.overlap)),d.length==2&&(e.verticesA[1]=d[1],e.verticesB[1]=d[1].clone().add($.copy(p).multiply(e.overlap)))),l==m&&(e.verticesA[0]=d[0].clone().add($.copy(p).multiply(e.overlap)),e.verticesB[0]=d[0],d.length==2&&(e.verticesA[1]=d[1].clone().add($.copy(p).multiply(e.overlap)),e.verticesB[1]=d[1])),e.contactNo=d.length,e},shapesCollided(a,t,e){let s=ke,n;y.clearArr(s),a.getNormals(t,s),n=s.length,t.getNormals(a,s),P.projectShapesToAxes(a,t,s,e,n)},projectShapesToAxes(a,t,e,s,n){let r=Ie;r.vertex=null,r.body=null,r.overlap=1/0;for(let h=0;h<e.length;h++){let l=De.copy(e[h]),p=a.getVertices(l),f=t.getVertices(l),m=P.projectVerticesToAxis(p,l,Oe),d=P.projectVerticesToAxis(f,l,Le),_=m.max<d.max?m.max:d.max,S=m.min>d.min?m.min:d.min,g=_-S;if(g<0)return s;if(m.max<d.max&&l.reverse(),m.max>d.max&&m.min<d.min||d.max>m.max&&d.min<m.min){let k=Math.abs(m.max-d.max),H=Math.abs(m.min-d.min);H<k?g+=H:(g+=k,l.reverse())}g<r.overlap&&(r.overlap=g,r.axis.copy(l),r.shape=h<=n-1?t:a,r.indexA=m.indexN,r.indexB=d.indexN,r.verticesA=p,r.verticesB=f)}return r.overlap>s.overlap&&(s.overlap=r.overlap,s.axis.copy(r.axis),s.dorminantShape=r.shape,s.shapes[0]=a,s.shapes[1]=t,s.vertShapeA=r.verticesA,s.vertShapeB=r.verticesB,s.indexA=r.indexA,s.indexB=r.indexB,s.done=!0),s},projectVerticesToAxis(a,t,e){let s=1/0,n=-1/0,r=null,h=a.length;for(let l=0;l<h;l++){let p=t.dot(a[l]);p<s&&(s=p,r=l),p>n&&(n=p)}return e.min=s,e.max=n,e.indexN=r,e},findNearSupports(a,t,e=[],s){let n=1/0,r=e,h=a.length;for(let l=0;l<h;l++){let p=t.dot(a[l]);if(Math.abs(p-n)<=.1&&!r.includes(a[l])){r.push(a[l]);continue}p<n&&(n=p,y.clearArr(r),r.push(a[l]),l=-1)}return r},shapeContains(a,t){return a.type=="circle"?P.circleContains(a.position,a.radius,t):P.verticesContain(a.vertices,t)},circleContains(a,t,e){let s=e.x-a.x,n=e.y-a.y;return!(s*s+n*n>t*t)},verticesContain(a,t){var e=t.x,s=t.y,n=a.length,r=a[n-1],h;if(n<2)return!1;for(var l=0;l<n;l++){if(h=a[l],(e-r.x)*(h.y-r.y)+(s-r.y)*(r.x-h.x)<0)return!1;r=h}return!0}};class Re{canCollide(t,e){return!(t.mass==0&&e.mass==0||t.mask.group!==0&&e.mask.group!==0&&t.mask.group==e.mask.group||t.mask.layer&&e.mask.layer&&t.mask.layer!==e.mask.layer||t.sleeping&&e.sleeping)}insert(){}remove(){}traverse(t){}draw(t){}update(t){}remove(t){}}class Fe extends Re{constructor(t){super(),this.bodies=t.objects}query(t,e){closeObjects=e||[];for(var s=0;s<this.objects.length;s++){let n=this.world.objects[s];n.bounds.intersects(t)<dist&&closeObjects.push(n)}return closeObjects}getCollisionPairs(t){t=t||[];let e=this.bodies,s=e.length;for(let n=0;n<s;n++){let r=e[n];for(let h=n+1;h<s;h++){let l=e[h];if(!this.canCollide(r,l)||!r.bounds.intersects(l.bounds))continue;let p={a:r,b:l};r.aabbDetectionOnly||l.aabbDetectionOnly||!r.shapes.length||!l.shapes.length||t.push(p)}}return t}}class Mt{constructor(){o(this,"count",0);o(this,"records",new Map);o(this,"objects",[]);o(this,"fixedConstraits",[]);o(this,"constraints",[]);o(this,"linearDamping",A.linearDamping);o(this,"angularDamping",A.angularDamping);o(this,"velocitySolverIterations",A.velocitySolverIterations);o(this,"CLMDs",[]);o(this,"contactList",[]);o(this,"gravitationalAcceleration",new c(0,0));o(this,"fixedFrameRate",A.fixedFrameRate);o(this,"perf",{lastTimestamp:0,total:0});o(this,"broadphase",null);this.broadphase=new Fe(this)}set gravity(t){if(typeof t=="object")return this.gravitationalAcceleration.copy(t);this.gravitationalAcceleration.set(0,t)}get gravity(){return this.gravitationalAcceleration}narrowPhase(){let t,e;for(var s=0;s<this.contactList.length;s++){let{a:n,b:r}=this.contactList[s];n.sleeping=!1,r.sleeping=!1;let h=dt(n.id,r.id);this.records.has(h)||this.records.set(h,{bodyA:n,bodyB:r,contactData:{lastOverlap:0,overlap:-1/0,done:!1,axis:new c,verticesA:[],verticesB:[],vertShapeA:null,vertShapeB:null,contactNo:0,shapes:[],indexA:0,indexB:0},stmp:-1,impulse:0,persistent:!1,ca1:new c,ca2:new c,restitution:0,staticFriction:0,kineticFriction:0,velA:new c,velB:new c,rotA:0,rotB:0}),e=this.records.get(h),t=e.contactData,t.overlap=-1/0,t.done=!1,P.shapesInBodyCollided(n,r,t),!(t.overlap<0||!t.done)&&(t.contactNo==2?(c.lerp(t.verticesA[0],t.verticesA[1],.5,e.ca1).sub(n.position),c.lerp(t.verticesB[0],t.verticesB[1],.5,e.ca2).sub(r.position)):(e.ca1.copy(t.verticesA[0]).sub(n.position),e.ca2.copy(t.verticesB[0]).sub(r.position)),e.restitution=n.restitution<r.restitution?n.restitution:r.restitution,e.staticFriction=n.staticFriction<r.staticFriction?n.staticFriction:r.staticFriction,e.kineticFriction=n.kineticFriction<r.kineticFriction?n.kineticFriction:r.kineticFriction,n.collisionResponse&&r.collisionResponse&&this.CLMDs.push(e))}}broadPhase(){this.contactList=[],this.broadphase.getCollisionPairs(this.contactList)}collisionDetection(){this.broadPhase(),this.narrowPhase()}collisionResponse(t){let e=this.CLMDs.length,s,n=1/t;this.count-1;for(var r=0;r<this.velocitySolverIterations;r++){for(let l=0;l<e;l++)s=this.CLMDs[l],s.velA.set(0,0),s.velB.set(0,0),s.rotA=0,s.rotB=0,Ee.solve(s),we.solve(s);for(var h=0;h<e;h++)s=this.CLMDs[h],s.bodyA.velocity.add(s.velA),s.bodyB.velocity.add(s.velB),s.bodyA.rotation.radian+=s.rotA,s.bodyB.rotation.radian+=s.rotB}for(let l=0;l<e;l++)s=this.CLMDs[l],Ce.solve(s,n);for(let l=0;l<e;l++)s=this.CLMDs[l],s.stmp=this.count,be.solve(s.bodyA,s.bodyB,s.impulse,s.contactData.contactNo)}intergrate(t,e){for(var s=0;s<e;s++){let n=this.objects[s];n.sleeping||ye.solve(n,t)}}applyGravity(t,e){this.gravitationalAcceleration.clone().multiply(e);for(var s=0;s<t;s++){let n=this.objects[s];n.mass&&n.acceleration.add(this.gravitationalAcceleration)}}updateConstraints(t){let e=this.constraints.length,s=this.fixedConstraits.length;for(var n=0;n<s;n++)this.fixedConstraits[n].update(t);for(var n=0;n<e;n++)this.constraints[n].update(t)}updateBodies(t){let e=1-this.linearDamping,s=1-this.angularDamping;for(var n=0;n<t;n++)this.objects[n].update(),this.objects[n].velocity.multiply(e),this.objects[n].angularVelocity=this.objects[n].angularVelocity*s}update(t){this.perf.lastTimestamp=performance.now();let e=this.fixedFrameRate||t,s=this.objects.length;this.CLMDs=[],this.applyGravity(s,e),this.updateBodies(s),this.broadphase.update(),this.updateConstraints(e),this.collisionDetection(),this.collisionResponse(e),this.updateConstraints(e),this.updateBodies(s),this.intergrate(e,s),this.count+=1,this.perf.total=performance.now()-this.perf.lastTimestamp}init(t){t.setComponentList("body",this.objects)}add(t){t.physicsType==C.BODY?this.addBody(t):t.physicsType==C.CONSTRAINT?this.addConstraint(t):t.physicsType==C.COMPOSITE&&this.addComposite(t)}addBody(t){t.update(),t.index=this.objects.length,this.objects.push(t),this.broadphase.insert(t)}remove(t){this.removeBody(t)}removeBody(t){if(this.broadphase.remove(t),y.removeElement(this.objects,t.index)){if(t.index===this.objects.length)return;this.objects[t.index].index=t.index}return t}addConstraint(t){if(t.fixed){t.index=this.fixedConstraits.length,this.fixedConstraits.push(t);return}t.index=this.constraints.length,this.constraints.push(t)}removeContraint(t){let s=(t.fixed?this.fixedConstraits:this.constraints).pop();return this.objects[t.index]=temp1,s.index=t.index,t.index=-1,t}addComposite(t){for(var e=0;e<t.bodies.length;e++)this.addBody(t.bodies[e]);for(var e=0;e<t.constraints.length;e++)this.addConstraint(t.constraints[e])}removeComposite(){for(var t=0;t<composite.bodies.length;t++)this.removeBody(composite.bodies[t]);for(var t=0;t<composite.constraints.length;t++)this.removeContraint(composite.constraints[t])}query(t,e=[]){return this.broadphase.query(t,e),e}}class je{constructor(t,e){o(this,"_position",new c);this.transformMatrix=new Y,this.target=null,this.lerpFactor=.5,this.renderer=t,this.position.set((e==null?void 0:e.x)||0,(e==null?void 0:e.y)||0),this.orientation=new B}get position(){return this._position}set position(t){this._position.copy(t)}get transform(){return this.position}update(t){this.target&&this._position.lerp(this.target,this.lerpFactor)}clear(t){t.setTransform()}dispose(){this.renderer=null}follow(t){this.target=t}}class Bt{constructor(t){o(this,"_accumulator",0);o(this,"_transforms",[]);o(this,"_rotation",0);o(this,"_translation",new c);o(this,"_scale",new c);o(this,"_fill","black");o(this,"_stroke","black");o(this,"frameRate",1/60);o(this,"objects",[]);o(this,"renderLast",[]);o(this,"perf",{lastTimestamp:0,total:0});o(this,"background",null);o(this,"domElement",null);o(this,"ctx",null);o(this,"camera",null);o(this,"_update",t=>{let e=this.clock.update(t);if(this._accumulator<this.frameRate){this._accumulator+=e,this.RAF();return}this.update(e||this._accumulator),this.RAF(),this._accumulator=0});this.domElement=t||document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.camera=new je(this),this.clock=new st}init(t){t.setComponentList("mesh",this.objects)}push(){this._transforms.push(this.ctx.getTransform())}pop(){this.ctx.setTransform(this._transforms.pop())}reset(){this.ctx.setTransform()}translate(t,e){this.ctx.translate(t,e)}scale(t,e){this.ctx.scale(t,e)}rotate(t){this.ctx.rotate(t),this._rotation+=t}line(t,e,s,n){this.ctx.moveTo(t-this.camera.position.x,e-this.camera.position.y),this.ctx.lineTo(s-this.camera.position.x,n-this.camera.position.y)}rect(t,e,s,n){this.ctx.rect(t-this.camera.position.x,e-this.camera.position.y,s,n)}circle(t,e,s){this.ctx.arc(t-this.camera.position.x,e-this.camera.position.y,s,0,Math.PI*2)}vertices(t,e=!0){this.ctx.moveTo(t[0].x-this.camera.position.x,t[0].y-this.camera.position.y);for(var s=1;s<t.length;s++)this.ctx.lineTo(t[s].x-this.camera.position.x,t[s].y-this.camera.position.y);e&&this.ctx.lineTo(t[0].x-this.camera.position.x,t[0].y-this.camera.position.y)}arc(t,e,s,n,r){this.ctx.arc(t-this.camera.position.x,e-this.camera.position.y,s,n,r)}fillText(t,e,s){this.ctx.fillText(t,e-this.camera.position.x,s-this.camera.position.y)}fill(t="black",e){this.ctx.fillStyle=t,this.ctx.fill(e)}stroke(t="black",e=1){this.ctx.strokeStyle=t,this.ctx.width=e,this.ctx.stroke()}begin(){this.ctx.beginPath()}close(){this.ctx.closePath()}clip(){this.ctx.clip()}drawImage(t,e,s,n=t.width,r=t.height,h=0,l=0){this.ctx.drawImage(t,n*h,r*l,n,r,e-this.camera.position.y,s-this.camera.position.y,n,r)}get width(){return this.domElement.clientWidth}get height(){return this.domElement.clientHeight}set width(t){this.domElement.width=t}set height(t){this.domElement.height=t}setViewport(t,e){this.width=t,this.height=e}set CSSbackground(t){this.domElement.style.background=t}get CSSbackground(){return this.domElement.style.background}clear(){this.reset();let t=this.height,e=this.width;this.ctx.clearRect(0,0,e,t)}update(t){this.perf.lastTimestamp=performance.now(),this.background!=null&&this.background.update(this,t);for(var e=0;e<this.objects.length;e++)this.objects[e].update(this,t);for(var e=0;e<this.renderLast.length;e++)this.renderLast[e].update(this,t,this.camera.transform);this.perf.total=performance.now()-this.perf.lastTimestamp}RAF(){this._rafID=requestAnimationFrame(this._update)}play(){this.RAF()}pause(){cancelAnimationFrame(this._rafID)}bindTo(t,e=!0){let s=document.querySelector(t);this.domElement.remove(),this.domElement.style.backgroundColor="grey",this.domElement.style.touchAction="none",s.append(this.domElement)}add(t){this.objects.push(t)}remove(t){this.objects.splice(this.objects.indexOf(t),1)}addUI(t){this.renderLast.push(t)}requestFullScreen(){this.domElement.parentElement.requestFullscreen()}}const O={webgpu:!1,webgl:!1,canvas2d:!1,canvas:!1,webAudio:!1,supportedAudio:[],supportedImages:[],windows:!1,mac:!1,android:!1,linux:!1,ios:!1,chrome:!1,firefox:!1,edge:!1,safari:!1};let V=navigator.userAgent;new Audio,/Android/.test(V)?O.android=!0:/iP[ao]d|iPhone/i.test(V)?O.ios=!0:/Linux/.test(V)?O.linux=!0:/Mac OS/.test(V)?O.mac=!0:/Windows/.test(V)&&(O.windows=!0),window.AudioContext&&(O.webAudio=!0),Object.freeze(O);class Et{constructor(t){this._toload=[],this.imgs={},this.sfx={},this.json={},this._progressBytes=0,this._totalBytes=0,this._filesErr=0,this._filesLoaded=0,this._totalFileNo=0;const e=this;this.onfinish=null,this._handlers={onload:function(s,n){let r=e._getType(s.responseURL),h=e._getName(s.responseURL);if(n.lengthComputable===!1){e._handlers.onerror(s,n);return}if(r==="image")e.imgs[h]=new Image,e.imgs[h].src=URL.createObjectURL(s.response);else if(r==="audio")e.sfx[h]=s.response;else if(r==="json")e.json[h]=JSON.parse(s.response);else return v.warn(`The file in url ${s.responseURL} is not loaded into the loader because its extension name is not supported.`);e._filesLoaded+=1,e._filesLoaded+e._filesErr===e._totalFileNo&&e.onfinish&&e.onfinish()},onheadload:function(s){if(s.total===0||!s.lengthComputable)return;e._totalBytes+=s.total;let n=new XMLHttpRequest;n.open("GET",files.images[i],!0),n.onload=r=>e._handlers.onload(n),n.onerror=e._handlers.onerror(n),n.send()},onerror:function(s){e._filesErr+=1,v.warn(`The file ${s.responseURL} could not be loaded as the file might not exist in current url`),e._filesLoaded+e._filesErr===e._totalFileNo&&e.onfinish&&e.onfinish()}}}_getName(t){if(t.includes("/")){let e=t.split("/");t=e[e.length-1]}return t.split(".")[0]}_getType(t){let e;if(t.includes("/")){let s=t.split("/");t=s[s.length-1]}if(e=t.split(".")[1],e==="jpg"||e==="png"||e==="jpeg")return"image";if(e==="mp3"||e==="ogg")return"audio";if(e==="json")return"json"}loadAll(t={}){var s,n,r;if(this._totalFileNo=(((s=t.images)==null?void 0:s.length)||0)+(((n=t.audio)==null?void 0:n.length)||0)+(((r=t.json)==null?void 0:r.length)||0),this._totalFileNo===0){this.onfinish();return}if(t.images)for(var e=0;e<t.images.length;e++){let h=new XMLHttpRequest;h.open("GET",t.images[e],!0),h.responseType="blob",h.onload=l=>{this._handlers.onload(h,l)},h.onerror=l=>this._handlers.onerror(h),h.send()}if(t.audio)for(var e=0;e<t.audio.length;e++){let l=new XMLHttpRequest;l.responseType="arraybuffer",l.open("GET",t.audio[e],!0),l.onload=p=>this._handlers.onload(l,p),l.onerror=p=>this._handlers.onerror(l),l.send()}if(t.json)for(var e=0;e<t.json.length;e++){t.json[e];let l=new XMLHttpRequest;l.responseType="text",l.open("GET",t.json[e],!0),l.onload=p=>this._handlers.onload(l,p),l.onerror=p=>this._handlers.onerror(l),l.send()}}}class kt{constructor(){o(this,"handlers",{})}trigger(t,e){t in this.handlers&&this.handlers[t].forEach(s=>s(e))}init(){}add(t,e){if(t in this.handlers){this.handlers[t].push(e);return}this.handlers[t]=[e]}}class It{constructor(){this.handlers={},this._evHandlers={}}add(t,e){if(this.handlers[t])return this.handlers[t].push(e);this.handlers[t]=[e];let s=n=>{let r=this.handlers[t];for(var h=0;h<r.length;h++)r[h](n)};document.addEventListener(t,s),this._evHandlers[t]=s}remove(t,e){this.handlers[t].splice(this.handlers[t].indexOf(e),1),this.handlers[t].length||this.dispose(t)}disposeEvent(t){document.removeEventListener(t,this._evHandlers[t]),delete this.handlers[t],delete this._evHandlers[t]}clear(){for(var t in this.handlers)this.dispose(t)}init(){}}function Ot(a){let t,e;for(let s=0;s<a.length;s++)t=a[s].bodyA.entity.getHandler("collision"),e=a[s].bodyB.entity.getHandler("collision"),t&&t(a[s].bodyA.entity,a[s].bodyB.entity,a[s]),e&&e(a[s].bodyB.entity,a[s].bodyA.entity,a[s])}function Lt(a){let t,e;for(let s=0;s<a.length;s++)t=a[s].a.entity.getHandler("precollision"),e=a[s].b.entity.getHandler("precollision"),t&&t(a[s].a.entity,a[s].b.entity,a[s]),e&&e(a[s].b.entity,a[s].a.entity,a[s])}const He={COLLISION:"collision",PRECOLLISION:"precollision",PREUPDATE:"preupdate",POSTUPDATE:"postupdate",UPDATE:"postupdate",INITIALIZE:"init",ADD:"add",REMOVE:"remove",PAUSE:"pause",PLAY:"play"};class Dt{constructor(t){o(this,"_onDown",t=>{let e=this.normalize(t.code);this.keys[e]=!0,this.activeKeys.push(e),this.ondown(t)});o(this,"_onUp",t=>{this.keys[this.normalize(t.code)]=!1,this.onup(t)});this.keys={},this.activeKeys=[],this.init(t)}normalize(t){let e=t;return t.includes("Key")&&(e=e.slice(3,e.length)),e.toUpperCase()}init(t){t.add("keydown",this._onDown),t.add("keyup",this._onUp)}ondown(t){}onup(t){}}class Nt{constructor(t){o(this,"_onClick",t=>{++this.clickCount,this.onclick(t)});o(this,"_onMove",t=>{this.position.x=t.clientX,this.position.y=t.clientY,this.lastPosition.x===void 0&&(this.lastPosition={...this.position}),this.delta.x=this.position.x-this.lastPosition.x,this.delta.y=this.position.y-this.lastPosition.y,this.dragging=!!(this.leftbutton||this.rightbutton),this.dragging||(this.dragLastPosition.x=t.clientX,this.dragLastPosition.y=t.clientY),this.onmove(t)});o(this,"_onDown",t=>{switch(t.button){case 0:this.leftbutton=!0;break;case 2:this.rightbutton=!0;break}this.ondown(t)});o(this,"_onUp",t=>{switch(t.button){case 0:this.leftbutton=!1;break;case 2:this.rightbutton=!1;break}this.onup(t)});o(this,"_onWheel",t=>{this.onwheel(t)});o(this,"_onContextMenu",t=>{t.preventDefault(),this.oncontextmenu(t)});this.clickCount=0,this.dragging=!1,this.dragLastPosition={},this.delta={},this.position={},this.lastPosition={x:0,y:0},this.leftbutton=null,this.rightbutton=null,this.init(t)}inDragBox(t){return!(!this.dragging||t.x>this.dragLastPosition.x&&t.x<this.position.x&&t.y>this.dragLastPosition.y&&t.y<this.position.y)}init(t){t.add("click",this._onClick),t.add("mousedown",this._onDown),t.add("mouseup",this._onUp),t.add("mousewheel",this._onWheel),t.add("mousemove",this._onMove),t.add("contextmenu",this._onContextMenu)}onmove(t){}onclick(t){}ondown(t){}onup(t){}onwheel(t){}oncontextmenu(t){}update(){this.lastPosition={...this.position}}}class Rt{constructor(t){o(this,"_onMove",t=>{t.preventDefault(),this.onmove(t)});o(this,"_onDown",t=>{this.touches=t.touches,this.ondown(t)});o(this,"_onUp",t=>{this.touches=t.touches,this.onup(t)});this.clickCount=0,this.touches=[],this.init(t)}inDragBox(t){return!(t.x>this.dragLastPosition.x&&t.x<this.dragLastPosition.x+this.position.x&&t.y>this.dragLastPosition.y&&t.y<this.dragLastPosition.y+this.position.y)}init(t){t.add("touchstart",this._onDown),t.add("touchend",this._onUp),t.add("touchmove",this._onMove)}onmove(t){}onclick(t){}ondown(t){}onup(t){}onwheel(t){}update(){}}class Ft{constructor(t){this.DOMEventHandler=t||new It,this.mouse=new Nt(this.DOMEventHandler),this.touch=new Rt(this.DOMEventHandler),this.keyboard=new Dt(this.DOMEventHandler)}update(){this.mouse.update(),this.touch.update()}dispose(){this.mouse.dispose(),this.keyboard.dispose(),this.touch.dispose()}}class ot{constructor(t={}){o(this,"_rafID");o(this,"_classes",{});o(this,"_componentLists",{});o(this,"_systems",[]);o(this,"_coreSystems",{world:null,renderer:null,input:null,events:null,audio:null});o(this,"_initialized",!1);o(this,"playing",!1);o(this,"_systemsMap",{});o(this,"_compMap",{});o(this,"clock",new st);o(this,"objects",[]);o(this,"_accumulator",0);o(this,"frameRate",0);o(this,"perf",{lastTimestamp:0,total:0});o(this,"loader",new Et);o(this,"_update",t=>{let e=this.clock.update(t);if(this._accumulator<this.frameRate){this._accumulator+=e,this.RAF();return}this._coreSystems.events&&this._coreSystems.events.trigger("updateStart"),this.update(e),this._coreSystems.events&&(this._coreSystems.events.trigger("update"),this._coreSystems.events.trigger("updateEnd")),this._accumulator=0,this.RAF()});t=Object.assign({autoPlay:!0},t),this.loader.onfinish=e=>{this.init(),this.play()},this.loader.loadAll(t.files)}init(){for(var t=0;t<this.objects.length;t++)this.objects[t].init(this);this._coreSystems.events&&this._coreSystems.events.trigger("init",this),this.update(0),this._initialized=!0,this.playing&&this.play()}add(t){if(t.manager){v.warn(`The entity with id ${t.id} has already been added to a manager.It will be ignored and not added to the manager`,t);return}this.objects.push(t),t.init(this),this._coreSystems.events&&this._coreSystems.events.trigger("add",t)}addComponent(t,e){if(t==="body"){this._coreSystems.world.add(e);return}if(t==="mesh"){this._coreSystems.renderer.add(e);return}t in this._componentLists&&this._componentLists[t].push(e)}removeComponent(t,e){if(t==="body"){this._coreSystems.world.remove(e);return}if(t==="mesh"){this._coreSystems.renderer.remove(e);return}t in this._componentLists&&y.removeElement(this._componentLists[t],this._componentLists[t].indexOf(e))}remove(t){let e=this.objects.indexOf(t);t.removeComponents(),y.removeElement(this.objects,e),this._coreSystems.events&&this._coreSystems.events.trigger("remove",t)}clear(){for(let t=this.objects.length-1;t>=0;t--)this.remove(this.objects[t])}RAF(){this._rafID=requestAnimationFrame(this._update)}play(){if(!this._initialized){this.playing=!0;return}this.RAF(),this._coreSystems.events&&this._coreSystems.events.trigger("play")}pause(){if(!this._initialized){this.playing=!1;return}cancelAnimationFrame(this._rafID),this._coreSystems.events&&this._coreSystems.events.trigger("pause")}initSystems(){for(var t=0;t<this._systems.length;t++)for(var e=0;e<this._systems[t].length;e++)this._systems[t][e].init(this)}update(t=.016){let e=this._coreSystems.world,s=this._coreSystems.renderer,n=this._coreSystems.events,r=this._coreSystems.input,h=performance.now();s&&s.clear();for(var l=0;l<this._systems.length;l++)this._systems[l].update(t);r&&r.update(),e&&e.update(t),s&&s.update(t),e&&n&&(n.trigger("precollision",e.contactList),n.trigger("collision",e.CLMDs)),this.perf.total=performance.now()-h}registerClass(t,e=!1){let s=t.name.toLowerCase();if(s in this._classes&&!e)return v.warn(`The class \`${t.name}\` is already registered.Set the second parameter of \`Manager.registerClass()\` to true if you wish to override the set class`);this._classes[s]=t}registerSystem(t,e,s=t){if(e.init&&e.init(this),this._systemsMap[t]===void 0)switch(t){case"events":this._coreSystems.events=e;break;case"world":this._coreSystems.world=e;break;case"renderer":this._coreSystems.renderer=e;break;case"input":this._coreSystems.input=e;break;default:this._systemsMap[t]=this._systems.length,this._systems.push(e),this._compMap[s]=t}}getSystem(t){return t in this._coreSystems?this._coreSystems[t]:this._systems[this._systemsMap[t]]}unregisterSystem(t){if(t in this._coreSystems)return this._systems[this._systemsMap[t]]=null;delete this._systems[this._systemsMap[t]],delete this._systemsMap[t]}setComponentList(t,e=[]){this._componentLists[t]=e}getComponentList(t){return this._componentList[t]}getEntityByComponents(t,e=this.objects){for(let s=0;s<e.length;s++)for(let n=0;n<t.length;n++)if(e[s].has(t[n]))return e[s]}getEntitiesByComponents(t,e=this.objects,s=[]){for(let n=0;n<e.length;n++)for(let r=0;r<t.length;r++)e[n].has(t[r])&&s.push(e[n]);return s}getEntityByTags(t,e=this.objects){for(let s=0;s<e.length;s++)for(let n=0;n<t.length;n++)if(e[s].hasTag(t[n]))return e[s]}getEntitiesByTags(t,e=this.objects,s=[]){for(let n=0;n<e.length;n++)for(let r=0;r<t.length;r++)e[n].hasTag(t[r])&&s.push(e[n])}infertype(t){let e=t.CHOAS_CLASSNAME;if(e){if(e in this._classes)return new this._classes[e];v.throw(`Class \`${e}\` is not registered in the manager thus cannot be used in cloning.Use \`Manager.registerClass\` to register it into this manager.`)}return t instanceof Array?[]:{}}clone(t){if(typeof t!="object")return t;let e=this.infertype(t);for(var s in t)e[s]=this.clone(t[s]);return e}static DefaultSystem(t){return{init(e){e.setComponentList(t)},update(e){let s=manager.getComponentList(t);for(let n=0;n<s.length;n++)s[n].update(e)}}}static Default(t){let e=new kt,s=new ot(t),n=new Bt,r=new Mt,h=new Ft;return e.add("collision",Ot),e.add("precollision",Lt),s.registerSystem("input",h),s.registerSystem("events",e),s.registerSystem("world",r),s.registerSystem("renderer",n),s}}class N{constructor(){o(this,"_position",new c);o(this,"_orientation",new B);o(this,"scale",new c(1,1));o(this,"_children",[]);o(this,"parent",null)}get angle(){return this._orientation.radian*180/Math.PI}set angle(t){this._orientation.degree=t}get position(){return this._position}set position(t){this._position.copy(t)}get orientation(){return this._orientation}set orientation(t){this._orientation.copy(t)}draw(t){t.circle(0,0,10)}update(t,e){let s=this._position.x,n=this._position.y;t.begin(),t.translate(s,n),t.rotate(this._orientation.radian),t.scale(this.scale),this.draw(t,e),t.close(),t.reset()}init(t){this.entity=t,this.requires("transform");let e=t.get("transform");this._position=e.position,this._orientation=e.orientation,this.bounds=parent.bounds}add(t){this._children.push(t)}remove(t,e=!1,s){let n=s??this._children.indexOf(t);if(n!==-1)return y.removeElement(this._children,n),!0;if(!e)return!1;for(var r=0;r<this._children.length;r++)if(this._children[r].remove(t,e,s))return!0;return!1}}y.inheritComponent(N);let lt=new c;class $e extends N{constructor(e={}){super();o(this,"drawVelocity",!1);o(this,"drawBounds",!1);this.drawVelocity=e.drawVelocity||!1,this.drawBounds=e.drawBounds||!1}update(e,s){if(this.body.physicsType==C.COMPOSITE)for(var n=0;n<this.body.bodies.length;n++)this.drawShapes(this.body.bodies[n],e);else this.drawShapes(this.body,e),this.drawVelocity==!0&&this.drawVelocity(this.body,e),this.drawBounds==!0&&this.drawBounds(this.body,e)}drawVelocity(e,s){s.begin(),s.line(e.position.x,e.position.y,e.position.x+e.velocity.x,e.position.y+e.velocity.y),s.stroke("cyan"),s.close}drawBounds(e,s){s.begin(),s.rect(e.bounds.min.x,e.bounds.min.y,e.bounds.max.x-this.body.bounds.min.x,e.bounds.max.y-this.body.bounds.min.y),s.stroke("red"),s.close()}drawShapes(e,s){s.begin();for(var n=0;n<e.shapes.length;n++){let r=e.shapes[n];r.type==E.CIRCLE?(s.circle(r.position.x,r.position.y,r.radius),c.fromRad(r.angle,lt).multiply(r.radius),s.line(...r.position,r.position.x+lt.x,r.position.y+lt.y)):s.vertices(r.vertices,!0)}s.stroke(),s.close()}init(e){this.body=e.get("body"),super.init(e)}}class Ve extends N{constructor(t){super(),this.manager=t,this.count=25,this.now=0,this.lastPerf={},this.drawBounds=!1}update(t,e){var p,f,m;this.now++;let s=this.manager.getSystem("renderer"),n=this.manager.getSystem("world"),r=(p=n==null?void 0:n.perf)==null?void 0:p.total,h=(f=s==null?void 0:s.perf)==null?void 0:f.total,l=1/e;this.now>this.count&&(this.lastPerf.rate=F(l,2),this.lastPerf.actual=F(1/(h+r)*1e3,2),this.lastPerf.phy=F(r,2),this.lastPerf.ren=F(h,2),this.lastPerf.tot=F(this.manager.perf.total,2),this.now=0),t.begin(),t.translate(s.width-80,80),t.fill("cyan"),t.fillText(this.lastPerf.actual+"afps",0,-20),t.fillText("render: "+this.lastPerf.ren+"ms",0,0),t.fillText("physics: "+this.lastPerf.phy+"ms",0,10),t.fillText("total: "+this.lastPerf.tot+"ms",0,20),t.fillText(`bodies: ${(m=n==null?void 0:n.objects)==null?void 0:m.length}`,0,30),this.lastPerf.rate>59?t.fill("cyan"):this.lastPerf.rate>29?t.fill("orange"):this.lastPerf.rate<=29&&t.fill("red"),t.fillText(this.lastPerf.rate+"fps",0,-30),t.close(),t.translate(-s.width+80,-80)}}class qe extends N{constructor(e,s,n){super();o(this,"_index",0);o(this,"_maxFrame",0);o(this,"_frame",0);o(this,"_accumulator",0);o(this,"_dt",0);o(this,"frameRate",1/60);o(this,"_maxFrames",null);o(this,"width",0);o(this,"height",0);o(this,"frameWidth",0);o(this,"frameHeight",0);this.img=e,this._maxFrame=(s||1)-1,e.onload=()=>{this.width=e.width,this.height=e.height,this.frameWidth=e.width/(s||1),this.frameHeight=e.height/(n||1)},this.width=0,this.height=0,this.frameWidth=0,this.frameHeight=0}setMaxFrames(...e){this._maxFrames=e}setIndex(e){this._maxFrame=this._maxFrames[e],this._index=e,this._frame=0}draw(e){e.drawImage(this.img,-this.frameWidth/2,-this.frameHeight/2,this.frameWidth,this.frameHeight,this._frame,this._index)}update(e,s){super.update(e,s),this._accumulator+=s,!(this._accumulator<this._frameRate)&&(this._accumulator=0,this._frame+=1,this._frame>this._maxFrame&&(this._frame=0))}}class Ue extends N{constructor(t,e,s){super(),this.img=t,t.onload=()=>{this.width=t.width,this.height=t.height},this.width=0,this.height=0,this.frameWidth=0,this.frameHeight=0}draw(t){t.drawImage(this.img,-this.frameWidth/2,-this.frameHeight/2,this.frameWidth,this.frameHeight,this._frame,this._index)}update(t,e){super.update(t,e),this._accumulator+=e,!(this._accumulator<this._frameRate)&&(this._accumulator=0,this._frame+=1,this._frame>this._maxFrame&&(this._frame=0))}}let Ye=new c;class jt{constructor(t,e,s=5){this.position=t,this.active=!0,this.velocity=new c,this.radius=e,this.color={r:100,g:255,b:255,a:1},this.lifespan=s,this._life=0}draw(t){t.begin(),t.circle(...this.position,this.radius),t.fill(`rgba(${this.color.r},${this.color.g},${this.color.b},${this.color.a})`),t.close()}update(t,e){this._life+=e,this.position.add(Ye.copy(this.velocity).multiply(e)),this.active=this._life<this.lifespan}init(){}}class ze extends N{constructor(t=1,e=100,s=5){super(),this.initial=t,this.frameIncrease=s,this.max=e}initParticles(t){for(var e=0;e<t;e++)this.add(this.create())}create(){return new jt(new c(...this.position),R(1,10),R(1,6))}init(t){super.init(t),this.initParticles(this.initial)}behavior(t){t.velocity.set(t.velocity.x+R(-1,1),t.velocity.y+R(0,.3))}update(t,e){for(let s=this._children.length-1;s>0;s--){let n=this._children[s];n.update(t,e),this.behavior(n),n.draw(t,e),n.active||this.remove(s)}this._children.length<this.max&&this.initParticles(this.frameIncrease)}remove(t){this._children.splice(t,1)}add(t){this._children.push(t)}}class We{constructor(t){o(this,"speed",1);this.img=t}draw(t,e,s){t.drawImage(this.img,e,s)}update(t,e){}}class Ge{constructor(...t){this.layers=t||[]}update(t,e){this.layers.forEach(s=>{s.draw(t,e)})}}class ht{constructor(){o(this,"_components",{});o(this,"_handlers",{});o(this,"_tags",new Set);o(this,"_global",null);o(this,"active",!1)}get CHAOS_OBJ_TYPE(){return"entity"}get CHAOS_CLASSNAME(){return this.constructor.name.toLowerCase()}destroy(){this.removeSelf();for(let t in this._components){let e=this._components[t];e.destroy&&e.destroy(),delete this._components[t]}for(let t in this._handlers)delete this._handlers[t]}removeSelf(){this._global&&this._global.remove(this),this.active=!1,this._global=null}removeComponents(){if(this._global!==void 0)for(var t in this._components)this._global.removeComponent(t,this._components[t])}get manager(){return this._global}attach(t,e){return this._components[t]=e,this.manager&&(e.init(this),this._global.addComponent(t,e)),this}remove(t){return this._global.removeComponent(t,this._components[t]),delete this._components[t],this}register(t,e){this._handlers[t]=e}unregister(t){t in this._handlers&&delete this._handlers[t]}getHandler(t){return this._handlers[t]}get(t){return this._components[t]}has(t){return t in this._components}addTag(t){this._tags.add(t)}removeTag(t){this._tags.delete(t)}hasTag(t){return this._tags.has(t)}init(t){this._global=t,this.active=!0;for(let e in this._components)this._components[e].init(this),t.addComponent(e,this._components[e])}static Default(t,e,s){return new ht().attach("transform",new Ht(t,e,s)).attach("movable",new $t).attach("bounds",new D)}query(t,e=[]){return this._global.query(t,e)}}class Ht{constructor(t,e,s){this.position=new c(t,e),this.orientation=new B(s)}init(){}}class $t extends W{constructor(t,e,s){super(),this.velocity=new c(t,e),this.rotation=new B(s),this.acceleration=new c}}class Vt{constructor(t,e){this.buffer=t.ctx.createBufferSource(),this.buffer.buffer=e,this.finished=!1,this.id=-1;let s=this;this.buffer.onended=()=>{t.remove(s.id),s.finished=!0}}play(t=0,e=0,s=!1){this.buffer.start(e,t),this.buffer.loop=s}disconnect(){this.buffer.disconnect()}connect(t){this.buffer.connect(t)}}class Je{constructor(){o(this,"ctx",new AudioContext);o(this,"sfx",{});o(this,"_backname","");o(this,"_background",null);o(this,"playing",[]);o(this,"toplay",{});o(this,"baseUrl","");o(this,"_mute",1);this.toplay={},this.gainNodes=[this.ctx.createGain()],this.gainNodes[0].connect(this.ctx.destination),this.canPlay=this.ctx.state=="running";let t=this;window.addEventListener("pointerdown",function e(){t.ctx.resume(),t.ctx.state=="running"&&(removeEventListener("pointerdown",e),t.canPlay=!0)})}load(t){let e=t.split(".")[0];fetch(this.baseUrl+"/"+t).then(s=>s.arrayBuffer()).then(s=>this.ctx.decodeAudioData(s)).then(s=>{this.sfx[e]=s,this._backname==e&&this.playMusic(e)}).catch(s=>console.log(s))}playMusic(t){this._backname=t,t in this.sfx&&(this._background=new Vt(this,this.sfx[t]),this._background.connect(this.gainNodes[0]),this._background.play(0,0,!0))}playEffect(t,e=!1){if(!(t in this.sfx)){this.toplay[t]=this.toplay[t]||0,this.toplay[t]=1;return}let s=new Vt(this,this.sfx[t]),n=this.playing.length;return s.id=n,s.connect(this.gainNodes[0]),this.playing.push(s),s.play(0,0,e),s}playAll(){this.playing.forEach(t=>{t.play()})}pauseAll(){this.playing.forEach(t=>{t.stop()})}mute(){this._mute=this.gainNodes[0].gain}unmute(){this.gainNodes[0].gain=this._mute}remove(t){t!=-1&&(y.removeElement(this.playing,t),t<this.playing.length&&(this.playing[t].id=t))}}class Xe{constructor(){this.objects=[]}init(t){t.setComponentList("agent",this.objects)}update(t){let e=1/t;for(var s=0;s<this.objects.length;s++)this.objects[s].update(e)}}class Ke{constructor(){this._behaviours=[],this._accumulated=new c,this.active=!1}add(t){this._behaviours.push(t),this.active&&t.init(this._agent)}remove(t){y.removeElement(this._behaviours,this._behaviours.indexOf(t))}init(t){this._agent=t;for(var e=0;e<this._behaviours.length;e++)this._behaviours[e].init(t)}update(t){let e=new c;this._accumulated.set(0,0);for(let s=0;s<this._behaviours.length;s++)this._behaviours[s].calc(e,t),this._accumulated.add(e);this._agent.acceleration.add(this._accumulated),this._agent.orientation.radian=c.toRad(this._agent.velocity)}clear(){y.clearArr(this._behaviours)}}class qt{constructor(){o(this,"velocity",null);o(this,"rotation",null);o(this,"maxSpeed",20);o(this,"maxTurnRate",5);o(this,"behaviours",new Ke)}init(t){this.parent=t,this.requires("transform","movable");let e=this.get("movable"),s=this.get("transform");this.velocity=e.velocity,this.rotation=e.rotation,this.position=s.position,this.orientation=s.orientation,this.acceleration=e.acceleration,this.behaviours.init(this)}add(t){this.behaviours.add(t)}remove(t){this.behaviours.remove(t)}update(t){this.behaviours.update(t)}}y.inheritComponent(qt);class q{constructor(){this.active=!0}init(){}update(){}calc(){}}let Ze=new c,Qe=new c;class ti extends q{constructor(e){super();o(this,"maxSpeed",800);o(this,"maxForce",2e3);o(this,"arrive",!1);o(this,"arrivespeed",1);o(this,"radius",100);let s=e.get("transform"),n=e.get("movable");this.pursuerPos=s.position,this.pursuerVel=n.velocity,this.pursuerRot=n.rotation,this.pursuerOrt=s.orientation}init(e){this.pursuedPos=e.position,this.pursuedVel=e.velocity,this.pursuedPosRot=e.rotation,this.pursuedOrt=e.orientation}calc(e,s){let n=Ze.copy(this.pursuedPos).sub(this.pursuerPos),r=Qe.copy(this.pursuedVel),h=n.magnitude();if(h==0||h>this.radius)return;n.setMagnitude(it(h,0,this.radius,this.maxSpeed,0));let l=n.sub(r).multiply(s);l.clamp(0,this.maxForce),e.copy(l)}}let ei=new c,Ut=new c;class ii extends q{constructor(){super();o(this,"maxSpeed",200);o(this,"maxForce",100);o(this,"_theta",90);o(this,"dtheta",10);o(this,"_radius",100)}init(e){this.pos=e.position,this.vel=e.velocity,this.pursuerRot=e.rotation,this.pursuerOrt=e.orientation}calc(e,s){this._theta+=R(-this.dtheta,+this.dtheta);let n=ei.copy(this.vel);n.equalsZero()&&c.random(n);let r=this._radius*.8;n.setMagnitude(this._radius),c.fromDeg(this._theta+c.toDeg(this.vel),Ut).multiply(r),n.add(Ut),n.setMagnitude(this.maxSpeed),n.sub(this.vel).multiply(s).clamp(0,this.maxForce),e.copy(n)}}class si{constructor(){}init(){}calc(t){}}class ni{constructor(){this.neighbours=[]}init(){}calc(t){}}let ri=new c,ai=new c;class oi extends q{constructor(e){super();o(this,"maxSpeed",1e3);o(this,"maxForce",2e3);o(this,"arrive",!1);o(this,"arrivespeed",1);o(this,"radius",100);let s=e.get("transform"),n=e.get("movable");this.pursuedPos=s.position,this.pursuedVel=n.velocity,this.pursuedRot=n.rotation,this.pursuedOrt=s.orientation}init(e){this.pursuerPos=e.position,this.pursuerVel=e.velocity,this.pursuerRot=e.rotation,this.pursuerOrt=e.orientation}calc(e,s){let n=ri.copy(this.pursuedPos).sub(this.pursuerPos),r=ai.copy(this.pursuerVel);n.setMagnitude(this.maxSpeed);let h=n.sub(r).multiply(s);h.clamp(0,this.maxForce),e.copy(h)}}let li=new c,hi=new c;class ci extends q{constructor(e){super();o(this,"maxSpeed",1e3);o(this,"maxForce",2e3);o(this,"arrive",!1);o(this,"arrivespeed",1);o(this,"radius",1e3);let s=e.get("transform"),n=e.get("movable");this.pursuedPos=s.position,this.pursuedVel=n.velocity,this.pursuedRot=n.rotation,this.pursuedOrt=s.orientation}init(e){this.pursuerPos=e.position,this.pursuerVel=e.velocity,this.pursuerRot=e.rotation,this.pursuerOrt=e.orientation}calc(e,s){let n=li.copy(this.pursuedPos).sub(this.pursuerPos),r=hi.copy(this.pursuerVel),h=n.magnitude();h<this.radius?n.setMagnitude(it(h,0,this.radius,0,this.maxSpeed)):n.setMagnitude(this.maxSpeed);let l=n.sub(r).multiply(s);l.clamp(0,this.maxForce),l.draw(ctx,...this.pursuerPos),e.copy(l)}}const ct={_pairs:null,split(){let a=document.cookie.split(";"),t={};for(let e=0;e<a.length;e++){let s=a[e].split("=");t[s[0]]=s[1]}return t},set(a,t,e=12e5){document.cookie=`${a}=${t};maxAge=${e}`},get(a){let t=document.cookie.split(";");for(var e=0;e<t.length;e++){let s=t[e].split("=");if(s[0].includes(a))return s[1]}},delete(a){document.cookie=`${a}=; max-age=0`},clear(){let a=document.cookie.split(";");for(var t=0;t<a.length;t++){let e=a[t].split("=");this.delete(e[0])}}};ct._pairs=ct.split();const ui={set(a,t){JSON.stringify(t),sessionStorage.setItem(a,t)},get(a){let t=sessionStorage.getItem(a);return JSON.parse(t)},clear(){sessionStorage.clear()}},di={set(a,t){JSON.stringify(t),localStorage.setItem(a,t)},get(a){let t=localStorage.getItem(a);return JSON.parse(t)},clear(){localStorage.clear()}};u.AABB=b,u.AABBox=D,u.Agent=qt,u.AgentManager=Xe,u.Angle=B,u.ArriveBehaviour=ci,u.AudioHandler=Je,u.Ball=ae,u.Behaviour=q,u.Body=T,u.BodyMesh=$e,u.Box=oe,u.Circle=G,u.Clock=st,u.Component=W,u.Composite=vt,u.Constraint=nt,u.Cookies=ct,u.DEVICE=O,u.DOMEventHandler=It,u.DebugMesh=Ve,u.DistanceConstraint=ue,u.Entity=ht,u.Err=v,u.EvadeBehaviour=ti,u.EventDispatcher=kt,u.Events=He,u.Flock=ni,u.Geometry=ft,u.HeightMap=re,u.ImageSprite=qe,u.Input=Ft,u.Keyboard=Dt,u.Layer=We,u.Line=yt,u.Loader=Et,u.Manager=ot,u.Matrix=Y,u.Mouse=Nt,u.Movable=$t,u.ParallaxBackground=Ge,u.Particle=jt,u.ParticleSystemSprite=ze,u.Pursuit=si,u.Rectangle=J,u.Renderer=Bt,u.SeekBehaviour=oi,u.Session=ui,u.Shape=E,u.SpringConstraint=fe,u.Sprite=N,u.StaticImageSprite=Ue,u.Storage=di,u.Touch=Rt,u.Transform=Ht,u.Triangle=ne,u.Utils=y,u.Vector=c,u.WanderBehaviour=ii,u.World=Mt,u.clamp=Jt,u.defaultCollisionHandler=Ot,u.defaultPrecollisionHandler=Lt,u.degToRad=Xt,u.exp=zt,u.lerp=Gt,u.map=it,u.naturalizePair=dt,u.radToDeg=Kt,u.rand=R,u.round=F,u.sq=M,u.sqrt=Wt,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
